    
    <!-- e-Referral Clinical Document:  7.1.5.1 Pathology Test Result -->

    <!-- Context: /ClinicalDocument/component/structuredBody/component[diag_inv]/section/ - Pathology Test Result -->

    <!-- Status: Last Reviewed: Not Reviewed
    Status: Last Updated : 11/07/2012 -->
    
    <!-- 02/07/2012 Mantis task 3739 - Updated the required rule context to include predicates -->

    <pattern name="p-e-Referral_3A_Pathology_Test_Result-errors"
        id="p-e-Referral_3A_Pathology_Test_Result-errors"
        see="#p-e-Referral_3A_Pathology_Test_Result-errors">



        <!-- section - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']">

            <!-- entry (PATHOLOGY TEST RESULT NAME)- 1..1 -->

            <assert test="cda:entry">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Result Name" - The 'entry' tag is missing. Refer to
                section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:entry) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result Name" - The 'entry' tag shall appear
                only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entry' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry"> -->

        </rule>

        <!-- entry - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry">

            <!-- observation - 1..1 -->

            <assert test="cda:observation">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result Name" - The 'observation' tag is
                missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:observation) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathology Test Result Name" - The 'observation'
                tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'observation' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation"> -->

        </rule>

        <!-- observation - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result Name" - The 'observation' tag
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result Name" - The 'observation' tag
                'moodCode' attribute shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- code - 1..1 -->

            <assert test="cda:code">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Result Name" - The 'code' tag is missing. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result Name" - The 'code' tag shall appear
                only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- The attributes of "cda:code" are being tested by e-Referral_Global_Checks.sch. -->


            <!-- entryRelationship[observation/code/@code='310074003'] (DIAGNOSTIC SERVICE) - 0..1 -->

            <report
                test="count(cda:entryRelationship[cda:observation/cda:code/@code='310074003']) > 1"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Diagnostic Service" - The 'entryRelationship/observation/code/@code="310074003"' tag shall appear only once.
                Refer to section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[observation/code/@code='310074003']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code='310074003']"> -->


            <!-- entryRelationship[observation/code/@code='308552006'] (OVERALL PATHOLOGY TEST RESULT STATUS) - 1..1 -->

            <assert test="cda:entryRelationship[cda:observation/cda:code/@code='308552006']">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Overall
                Pathology Test Result Status" - The 'entryRelationship/observation/code/@code="308552006"' tag
                is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report
                test="count(cda:entryRelationship[cda:observation/cda:code/@code='308552006']) > 1"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Overall Pathology Test Result Status" - The 'entryRelationship/observation/code/@code="308552006"'
                tag shall appear only once. Refer to
                section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[observation/code/@code='308552006']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code='308552006']">
                in file 'e-Referral_3A_Common_Sections_Result_Status.sch'
            -->


            <!-- entryRelationship[/act/code/@code='55752-0'] (CLINICAL INFORMATION PROVIDED) - 0..1 -->

            <report test="count(cda:entryRelationship[cda:act/cda:code/@code='55752-0']) > 1">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Clinical
                Information Provided" - The 'entryRelationship/act/code/@code="55752-0"' tag
                shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[act/code/@code='55752-0']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship[cda:act/cda:code/@code='55752-0']">
                in file 'e-Referral_3A_Common_Sections_Clinical_Information_Provided.sch'
            -->


            <!-- entryRelationship[observation/code/@code='88101002'] (PATHOLOGICAL DIAGNOSIS) - 0..* -->
            <!-- For 'entryRelationship[observation/code/@code='88101002']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code='88101002']"> -->


            <!-- entryRelationship[observation/code/@code='386344002'] (PATHOLOGY TEST CONCLUSION) - 0..1 -->

            <report
                test="count(cda:entryRelationship[cda:observation/cda:code/@code='386344002']) > 1"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Conclusion" - The 'entryRelationship/observation/code/@code="386344002"' tag
                shall appear only once. Refer to section 7.1.5.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[observation/code/@code='386344002']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code='386344002']"> -->


            <!-- value (TEST RESULT REPRESENTATION) - 0..1 -->

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.1 Pathology Test Result -
                "Test Result Representation" - The 'value' tag shall appear only once. Refer to
                section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[observation/code/@code='386344002']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:value"> -->


            <!-- entryRelationship[act/@code="103.16468"] (TEST COMMENT) - 0..1 -->

            <report test="count(cda:entryRelationship[cda:act/cda:code/@code='103.16468']) > 1"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Comment" - The 'entryRelationship[act/code/@code="103.16468"' tag
                shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[act/code/@code='103.16468']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:act/cda:code/@code='103.16468']"> -->


            <!-- entryRelationship[act/code/@code='102.16160'] (TEST REQUEST DETAILS) - 0..* -->
            <!-- For 'entryRelationship[act/code/@code='102.16160']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:act/cda:code/@code='102.16160']"> -->


            <!-- entryRelationship[cda:act/cda:entryRelationship/cda:observation/cda:code/@code = '103.11017'] (TEST REQUEST DETAILS / TEST REQUESTED NAME) - 0..* -->
            <!-- For 'entryRelationship[cda:act/cda:entryRelationship/cda:observation/cda:code/@code = '103.11017']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship[cda:observation/cda:code/@code = '103.11017']"> -->


            <!-- id (TEST REQUEST DETAILS / LABORATORY TEST RESULT IDENTIFIER) - 0..1 -->

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Laboratory Test Result Identifier" -
                The 'id' tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>


            <!-- entryRelationship[observation/code/@code='103.16605'] (PATHOLOGY TEST RESULT DATETIME) - 1..1 -->

            <assert test="cda:entryRelationship[cda:observation/cda:code/@code='103.16605']">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathology Test
                Result DateTime" - The 'entryRelationship/observation/code/@code="103.16605"' tag
                is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report
                test="count(cda:entryRelationship[cda:observation/cda:code/@code='103.16605']) > 1"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" - The 'entryRelationship/observation/code/@code="103.16605"' tag
                shall appear only once. Refer to section 7.1.5.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'entryRelationship[observation/code/@code='103.16605']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code='103.16605']"> -->

        </rule>

        <!-- 11/07 - Updated as per MANTIS task 3794 - Enforcing No Nullflavor attributes -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:code">
        
            <assert test="not(@nullFlavor)">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result Name" -
                "ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:code" - 
                The 'code' tag 'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
        
        </rule>
        <!-- End of Update -->

        <!-- ========================================================================================== -->

        <!-- entryRelationship[observation/code/@code='310074003'] (DIAGNOSTIC SERVICE) - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:observation/cda:code/@code='310074003']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'entryRelationship' tag
                'typeCode' attribute shall contain a value 'COMP'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


            <!-- observation[code/@code="310074003"] - 1..1 -->

            <report test="count(cda:observation) > 1"> Error: e-Referral
                - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The
                'observation' tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'observation[code/@code="310074003"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='310074003']"> -->

        </rule>

        <!-- observation[code/@code="310074003"] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='310074003']">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Diagnostic Service" - The 'observation' tag 'classCode' attribute is
                missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'observation' tag
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Diagnostic Service" - The 'observation' tag 'moodCode' attribute is
                missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'observation' tag 
                'moodCode' attribute shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


            <!-- code[@code="310074003"] - 1..1 -->

            <report test="count(cda:code) > 1"> Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'code' tag shall appear only
                once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="310074003"]' tag see below rule context:  <rule context="cda:code[@code='310074003']"> -->


            <!-- value - 1..1 -->

            <assert test="cda:value">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Diagnostic Service" - The 'value' tag is missing. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'value' tag shall appear only
                once. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'value' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='310074003']/cda:value"> -->

        </rule>

        <!-- code[@code="310074003"] - 0..1 -->
        <rule context="cda:code[@code='310074003']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '310074003']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/observation/code/@code = "310074003"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 Pathology Test Result of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '2.16.840.1.113883.6.96'">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The 'code'
                tag 'codeSystem' attribute shall contain a value '2.16.840.1.113883.6.96'. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemVersion - 1..1 -->

            <assert test="@codeSystemVersion = '20110531'">Error: e-Referral - 7.1.5.1 PATHOLOGY
                TEST RESULT - "Pathology Test Result / Diagnostic Service" - The 'code' tag 
                e 'codeSystemVersion' attribute shall contain a value '20110531'. Refer to section
                7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SNOMED CT-AU'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Diagnostic Service" - The 'code' tag 'codeSystemName' attribute shall contain a value
                'SNOMED CT-AU'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'PATHOLOGY SERVICE'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Diagnostic Service" - The 'code' tag 'displayName' attribute shall contain a value
                'pathology service'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <!-- value (DIAGNOSTIC SERVICE) - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='310074003']/cda:value">

            <!--<assert test="@code or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'value' tag having an associated
                'code' attribute OR 'nullFlavor' attribute shall appear once. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="@code and @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'value' tag shall have an
                associated 'code' OR 'nullFlavor' attribute but not both. Refer to section 7.1.5.1
                and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

            <!--<assert test="@codeSystem or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Diagnostic Service" - The 'value' tag having an
                associated 'codeSystem' attribute OR 'nullFlavor' attribute shall appear once. Refer
                to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="@codeSystem and @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Diagnostic Service" - The 'value' tag shall have
                an associated 'codeSystem' OR 'nullFlavor' attribute but not both. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

            <assert test="cda:originalText or (@code and @codeSystem) or @nullFlavor or cda:translation">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The 'code' tag shall have 'originalText' or 'transalation' tag or 'code'
                and 'codeSystem' OR 'nullFlavor' attributes. Check all 'cda:code' tags to find the missing attribute. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="@code and normalize-space(@code) = ''">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The 'value'
                tag 'code' attribute shall contain a value. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="@codeSystem and normalize-space(@codeSystem) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The
                'value' tag 'codeSystem' attribute shall contain a value. Refer to section 7.1.5.1
                and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystemName and normalize-space(@codeSystemName) = ''">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic
                Service" - The 'value' tag 'codeSystemName' attribute shall contain a value. Refer
                to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@displayName and normalize-space(@displayName) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The
                'value' tag 'displayName' attribute shall contain a value. Refer to section 7.1.5.1
                and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="cda:translation and normalize-space(cda:translation) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Diagnostic Service" - The
                'translation' tag shall contain a value. Refer to section 7.1.5.1
                and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- @xsi:type - 1..1 -->

            <assert test="@xsi:type = 'CD'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'value' tag 'xsi:type' attribute
                shall contain a value 'CD'. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="cda:originalText and normalize-space(cda:originalText) = ''">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'originalText' tag
                shall contain a value. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="count(cda:originalText) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Diagnostic Service" - The 'originalText' tag
                shall appear only once. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

           
        <!-- ========================================================================================== -->

        <!-- entryRelationship[observation/code/@code='88101002'] (PATHOLOGICAL DIAGNOSIS) - 0..* -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:observation/cda:code/@code='88101002']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'REFR'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'entryRelationship' tag
                'typeCode' attribute shall contain a value 'REFR'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- observation[code/@code="88101002"] - 1..1 -->

            <report test="count(cda:observation) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathological Diagnosis" - The 'observation' tag
                shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'observation[code/@code="88101002"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='88101002']"> -->

        </rule>

        <!-- observation[code/@code="88101002"] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='88101002']">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathological Diagnosis" - The 'observation' tag 'classCode' attribute
                is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'observation' tag 
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathological Diagnosis" - The 'observation' tag 'moodCode' attribute
                is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'observation' tag 
                'moodCode' attribute shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- code[@code="88101002"] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'code' tag shall appear only
                once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="88101002"]' tag see below rule context:  <rule context="cda:code[@code='88101002']"> -->


            <!-- value - 1..* -->
            <!-- SV - Updated - 28/02/2012 - Mantis ID 2449 -->
            
            <assert test="cda:value">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'value' tag 
                is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <!--End of SV's - Update - 28/02/2012 - Mantis ID 2449 -->

            <!-- For 'value' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='88101002']/cda:value"> -->

        </rule>

        <!-- code[@code="88101002"] - 0..* -->
        <rule context="cda:code[@code='88101002']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '88101002']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/observation/code/@code = "88101002"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 Pathology Test Result of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '2.16.840.1.113883.6.96'">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" - The
                'code' tag 'codeSystem' attribute shall contain a value '2.16.840.1.113883.6.96'.
                Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemVersion - 1..1 -->

            <assert test="@codeSystemVersion = '20110531'">Error: e-Referral - 7.1.5.1 PATHOLOGY
                TEST RESULT - "Pathology Test Result / Pathological Diagnosis" - The 'code' tag
                'codeSystemVersion' attribute shall contain a value '20110531'. Refer to section
                7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SNOMED CT-AU'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathological Diagnosis" - The 'code' tag 'codeSystemName' attribute
                shall contain a value 'SNOMED CT-AU'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'PATHOLOGY DIAGNOSIS'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathological Diagnosis" - The 'code' tag 'displayName' attribute shall contain a value
                'pathology diagnosis'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <!-- value (PATHOLOGICAL DIAGNOSIS) - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='88101002']/cda:value">

            <!--<assert test="@code or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'value' tag having an
                associated 'code' attribute OR 'nullFlavor' attribute shall appear once. Refer to
                section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="@code and @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'value' tag shall have an
                associated 'code' OR 'nullFlavor' attribute but not both. Refer to section 7.1.5.1
                and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

           <!-- <assert test="@codeSystem or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathological Diagnosis" - The 'value' tag having
                an associated 'codeSystem' attribute OR 'nullFlavor' attribute shall appear once.
                Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="@codeSystem and @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathological Diagnosis" - The 'value' tag shall
                have an associated 'codeSystem' OR 'nullFlavor' attribute but not both. Refer to
                section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

            <assert test="cda:originalText or (@code and @codeSystem) or @nullFlavor or cda:translation">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" - The 'code' tag shall have 'originalText' or 'transalation' tag or 'code'
                and 'codeSystem' OR 'nullFlavor' attributes. Check all 'cda:code' tags to find the missing attribute. Refer to section 7.1.5.1 and 8.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="@code and normalize-space(@code) = ''">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" - The
                'value' tag 'code' attribute shall contain a value. Refer to section 7.1.5.1 and 8.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="@codeSystem and normalize-space(@codeSystem) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" -
                The 'value' tag 'codeSystem' attribute shall contain a value. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystemName and normalize-space(@codeSystemName) = ''">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological
                Diagnosis" - The 'value' tag 'codeSystemName' attribute shall contain a value. Refer
                to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@displayName and normalize-space(@displayName) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" -
                The 'value' tag 'displayName' attribute shall contain a value. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="cda:translation and normalize-space(cda:translation) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathological Diagnosis" -
                The 'translation' tag shall contain a value. Refer to section
                7.1.5.1 and 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- @xsi:type - 1..1 -->

            <assert test="@xsi:type = 'CD'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'value' tag 'xsi:type'
                attribute shall contain a value 'CD'. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="cda:originalText and normalize-space(cda:originalText) = ''">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'originalText' tag
                shall contain a value. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="count(cda:originalText) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathological Diagnosis" - The 'originalText' tag
                shall appear only once. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>


        <!-- ========================================================================================== -->

        <!-- entryRelationship[observation/code/@code='386344002'] (PATHOLOGY TEST CONCLUSION) - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:observation/cda:code/@code='386344002']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'REFR'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The parent 'entryRelationship'
                tag 'typeCode' attribute shall contain a value 'REFR'. Refer to section 7.1.5.1 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- observation[code/@code="386344002"] - 1..1 -->

            <report test="count(cda:observation) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathology Test Conclusion" - The 'observation' tag
                shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'observation[code/@code="386344002"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='386344002']"> -->

        </rule>

        <!-- observation[code/@code="386344002"] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='386344002']">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Conclusion" - The 'observation' tag 
                'classCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'observation' tag
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Conclusion" - The 'observation' tag 
                'moodCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'observation' tag
                'moodCode' attribute shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- id - 1..1 -->

            <assert test="cda:id">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Conclusion" - The 'id' tag is missing. Refer to section
                7.1.5.1 and 8.2 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'id' tag shall appear once
                only. Refer to section 7.1.5.1 and 8.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- code[@code="386344002"] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'code' tag shall appear
                only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="386344002"]' tag see below rule context:  <rule context="cda:code[@code='386344002']"> -->


            <!-- value - 1..1 -->

            <assert test="cda:value">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Conclusion" - The 'value' tag is missing. Refer to
                section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'value' tag shall appear
                only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'value' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='386344002']/cda:value"> -->

        </rule>

        <!-- code[@code="386344002"] - 0..1 -->
        <rule context="cda:code[@code='386344002']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '386344002']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathology Test Conclusion" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/observation/code/@code = "386344002"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 Pathology Test Result of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '2.16.840.1.113883.6.96'">Error: e-Referral - 7.1.5.1
                Pathology Test Result - "Pathology Test Conclusion" - The 'code' tag 
                'codeSystem' attribute shall contain a value '2.16.840.1.113883.6.96'. Refer to section 7.1.5.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemVersion - 1..1 -->

            <assert test="@codeSystemVersion = '20110531'">Error: e-Referral - 7.1.5.1 Pathology
                Test Result - "Pathology Test Conclusion" - The 'code' tag 
                'codeSystemVersion' attribute shall contain a value '20110531'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SNOMED CT-AU'"
                >Error: e-Referral - 7.1.5.1 Pathology Test Result - "Pathology Test Conclusion" -
                The 'code' tag 'codeSystemName' attribute shall contain a value 'SNOMED CT-AU'.
                Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'LABORATORY FINDINGS DATA INTERPRETATION'"
                >Error: e-Referral - 7.1.5.1 Pathology Test Result - "Pathology Test Conclusion" -
                The 'code' tag 'displayName' attribute shall contain a value 'laboratory findings data
                interpretation'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- value (PATHOLOGY TEST CONCLUSION) - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='386344002']/cda:value">

            <assert test="normalize-space(.) !=  ''">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathology Test Conclusion" - The 'value' tag shall
                contain a value. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @xsi:type - 1..1 -->

            <assert test="@xsi:type = 'ST'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Conclusion" - The 'value' tag 'xsi:type'
                attribute shall contain a value 'ST'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- ========================================================================================== -->

        <!-- value (TEST RESULT REPRESENTATION) - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:value">

            <assert test="cda:reference or normalize-space(.) != ''">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Result Representation" - The
                'value' tag shall contain a value or a reference. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@xsi:type">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Result Representation" - The 'value' tag 'xsi:type'
                attribute is missing. Refer to section 7.1.5.1.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@xsi:type = 'ED'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Result Representation" - The 'value' tag 'xsi:type'
                attribute shall contain a value 'ED'. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- ========================================================================================== -->

        <!-- entryRelationship[act/code/@code='103.16468'] (TEST COMMENT) - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code='103.16468']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The parent 'entryRelationship' tag
                'typeCode' attribute shall contain a value 'COMP'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- act[code/@code="103.16468"] - 1..1 -->

            <report test="count(cda:act) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'act' tag shall appear only once. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'act[code/@code="103.16468"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='103.16468']"> -->

        </rule>

        <!-- act[code/@code="103.16468"] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='103.16468']">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Comment" - The 'act' tag 'classCode' attribute is missing. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'INFRM'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'act' tag 'classCode' attribute shall
                contain a value 'INFRM'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Comment" - The 'act' tag 'moodCode' attribute is missing. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'act' tag 'moodCode' attribute shall
                contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- code[@code="103.16468"] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'code' tag shall appear only once.
                Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="103.16468"]' tag see below rule context:  <rule context="cda:code[@code='103.16468']"> -->


            <!-- text - 1..1 -->

            <assert test="cda:text">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Comment" - The 'text' tag is missing. Refer to section 7.1.5.1 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:text) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'text' tag shall appear only once.
                Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'text' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='103.16468']/cda:text"> -->

        </rule>

        <!-- code[@code="103.16468"] - 0..1 -->
        <rule context="cda:code[@code='103.16468']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code = '103.16468']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Comment" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/act/code/@code = "103.16468"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 Pathology Test Result of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.1
                Pathology Test Result - "Test Comment" - The 'code' tag 'codeSystem'
                attribute shall contain a value '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.1 Pathology Test Result - "Test Comment" - The 'code' tag
                'codeSystemName' attribute shall contain a value 'NCTIS Data Components'. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'TEST COMMENT'"
                >Error: e-Referral - 7.1.5.1 Pathology Test Result - "Test Comment" - The 'code' tag
                'displayName' attribute shall contain a value 'Test Comment'. Refer to section
                7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <!-- text (TEST COMMENT) - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='103.16468']/cda:text">

            <assert test="normalize-space(.) != ''">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Test Comment" - The 'text' tag shall contain a
                value. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @xsi:type - 1..1 -->

            <assert test="@xsi:type = 'ST'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Comment" - The 'value' tag 'xsi:type' attribute shall
                contain a value 'ST'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- ========================================================================================== -->

        <!-- entryRelationship[act/code/@code='102.16160'] (TEST REQUEST DETAILS) - 0..* -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code='102.16160']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'SUBJ'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details" - The 'entryRelationship' tag 'typeCode' attribute 
                shall contain a value 'SUBJ'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @inversionInd - 1..1 -->

            <assert test="@inversionInd = 'true'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT
                - "Pathology Test Result / Test Request Details" - The 'entryRelationship' tag 'inversionInd' attribute
                shall contain a value 'true'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- act[code/@code="102.16160"] - 1..1 -->

            <report test="count(cda:act) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details" - The 'act' tag shall appear only
                once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'act[code/@code="102.16160"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='102.16160']"> -->

        </rule>


        <!-- act[code/@code="102.16160"] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='102.16160']">

            <!-- @classCode -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Request Details" - The 'act' tag 'classCode' attribute is
                missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'ACT'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details" - The 'act' tag 'classCode' attribute
                shall contain a value 'ACT'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Request Details" - The 'act' tag 'moodCode' attribute is missing.
                Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details" - The 'act' tag 'moodCode' attribute
                shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- code[@code="102.16160"] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details" - The 'code' tag shall appear only
                once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="102.16160"]' tag see below rule context:  <rule context="cda:code[@code='102.16160']"> -->


            <!-- cda:entryRelationship[cda:observation/cda:code/@code = '103.11017'] (TEST REQUESTED NAME )- 0..* -->
            <!-- For 'cda:entryRelationship[cda:observation/cda:code/@code = '103.11017']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship[cda:observation/cda:code/@code = '103.11017']"> -->

        </rule>

        <!-- code[@code="102.16160"] - 0..* -->
        <rule context="cda:code[@code='102.16160']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code = '102.16160']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/act/code/@code = "102.16160"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details" - The 'code'
                tag 'codeSystem' attribute shall contain a value '1.2.36.1.2001.1001.101'. Refer
                to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Request Details" - The 'code' tag 'codeSystemName' attribute shall contain a value
                'NCTIS Data Components'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'TEST REQUEST DETAILS'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Request Details" - The 'code' tag 'displayName' attribute shall contain a value 'Test
                Request Details'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- ========================================================================================== -->

        <!-- cda:entryRelationship[cda:observation/cda:code/@code = '103.11017'] (TEST REQUESTED NAME )- 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship[cda:observation/cda:code/@code = '103.11017']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The
                'entryRelationship' tag 'typeCode' attribute shall contain a value 'COMP'. Refer to
                section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- cda:observation[cda:code/@code = '103.11017'] - 1..1 -->

            <report test="count(cda:observation) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Test Request Details / Test Requested Name" - The
                'observation' tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'cda:observation[cda:code/@code = '103.11017']' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship/cda:observation[cda:code/@code = '103.11017']"> -->
        </rule>


        <!-- cda:observation[cda:code/@code = '103.11017'] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship/cda:observation[cda:code/@code = '103.11017']">

            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Request Name / Test Requested Name" - The 'act' tag 
                'classCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Name / Test Requested Name" - The 'act' tag
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Request Name / Test Requested Name" - The 'act' tag 
                'moodCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'RQO'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Name / Test Requested Name" - The 'act' tag
                'moodCode' attribute shall contain a value 'RQO'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


            <!-- cda:code[@code = '103.11017'] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'code'
                tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="103.11017"]' tag see below rule context:  <rule context="cda:code[@code='103.11017']"> -->


            <!-- value - 1..1 -->

            <assert test="cda:value">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Test Request Details / Test Requested Name" - The 'value' tag is
                missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'value'
                tag shall appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'value' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship/cda:observation[cda:code/@code = '103.11017']/cda:value"> -->

        </rule>

        <!-- cda:code[@code = '103.11017'] - 0..* -->
        <rule context="cda:code[@code='103.11017']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '103.11017']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test Requested Name" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/act/entryRelationship/observation/code/@code = "103.11017"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystem - 1..1 -->

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'code' tag 'codeSystem' attribute shall contain a value
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @codeSystemName - 1..1 -->

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Request Details / Test Requested Name" - The 'code' tag
                'codeSystemName' attribute shall contain a value 'NCTIS Data Components'. Refer to section
                7.1.5.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @displayName - 1..1 -->

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'TEST REQUESTED NAME'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Request Details / Test Requested Name" - The 'code' tag 'displayName'
                attribute shall contain a value 'Test Requested Name'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <!-- value (TEST REQUESTED NAME) - 1..1 -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='102.16160']/cda:entryRelationship/cda:observation[cda:code/@code = '103.11017']/cda:value">

            <!--<assert test="@code or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'value'
                tag shall have 'code' or 'nullFlavor' attribute. Refer to section 8.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem or @nullFlavor">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Test Request Details / Test Requested Name" - The
                'value' tag shall have 'codeSystem' or 'nullFlavor' attribute. Refer
                to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="(@code and not(@codeSystem)) or (not(@code) and @codeSystem)"> Error:
                Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test
                Request Details / Test Requested Name" - The 'value' tag 
                shall have 'code' and 'codeSystem' attributes. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="(@code or @codeSystem) and @nullFlavor">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'value' tag shall have 'code' and 'codeSystem' OR
                'nullFlavor' attribute but not both. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

            <assert test="cda:originalText or (@code and @codeSystem) or @nullFlavor or cda:translation">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'code' tag shall have 'originalText' or 'transalation' tag or 'code'
                and 'codeSystem' OR 'nullFlavor' attributes. Check all 'cda:code' tags to find the missing attribute. Refer to section 7.1.5.1 and 8.1
                of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="@code and normalize-space(@code) = ''">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'value' tag 'code' attribute shall contain a value. Refer to
                section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystem and normalize-space(@codeSystem) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'value' tag 'codeSystem' attribute shall contain a value.
                Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystemName and normalize-space(@codeSystemName) = ''">Error:
                e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request
                Details / Test Requested Name" - The 'value' tag 'codeSystemName' attribute shall
                contain a value. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@displayName and normalize-space(@displayName) = ''">Error: e-Referral -
                7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Test Request Details / Test
                Requested Name" - The 'value' tag 'displayName' attribute shall contain a value.
                Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- @xsi:type - 1..1 -->

            <assert test="@xsi:type = 'CD'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'text'
                tag 'xsi:type' attribute shall contain value 'CD'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="cda:originalText and normalize-space(cda:originalText) = ''">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'originalText' tag
                shall contain a value. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="count(cda:originalText) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Test Request Details / Test Requested Name" - The 'originalText' tag
                shall appear only once. Check all 'code/cda:originalText' tags to find the missing
                text. Refer to section 7.1.5.1 and 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            

        </rule>


        <!-- ========================================================================================== -->

        <!-- entryRelationship[observation/code/@code='103.16605'] (PATHOLOGY TEST RESULT DATETIME) - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:observation/cda:code/@code='103.16605']">

            <!-- @typeCode - 1..1 -->

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result DateTime" - The 'entryRelationship'
                tag 'typeCode' attribute shall contain a value 'COMP'. Refer to section 7.1.5.1 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- observation[code/@code='103.16605'] - 1..1 -->

            <report test="count(cda:observation) > 1">Error: e-Referral - 7.1.5.1 Pathology Test
                Result - "Pathology Test Result DateTime" - The 'observation' tag shall appear only
                once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'observation[code/@code="103.16605"]' tag see below rule context:  
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation/cda:entryRelationship/cda:observation[cda:code/@code='103.16605']"> -->

        </rule>

        <!-- observation[code/@code='103.16605'] - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='103.16605']">

             <!-- 11/07 - Updated as per MANTIS task 3794 - Enforcing No Nullflavor attributes -->

            <assert test="not(@nullFlavor)">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" -
                "ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:observation" - 
                The 'observation' tag 'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
        
            <!--End of Update -->
            
            <!-- @classCode - 1..1 -->

            <assert test="@classCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Result DateTime" - The 'observation' tag 
                'classCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result DateTime" - The 'observation' tag
                'classCode' attribute shall contain a value 'OBS'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- @moodCode - 1..1 -->

            <assert test="@moodCode">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology
                Test Result / Pathology Test Result DateTime" - The 'observation' tag 
                'moodCode' attribute is missing. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result DateTime" - The 'observation' tag
                'moodCode' attribute shall contain a value 'EVN'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


            <!-- code[@code='103.16605'] - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result DateTime" - The 'code' tag shall
                appear only once. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- For 'code[@code="103.16605"]' tag see below rule context:  <rule context="cda:code[@code='103.16605']"> -->


            <!-- effectiveTime - 1..1 -->

            <assert test="cda:effectiveTime">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT -
                "Pathology Test Result / Pathology Test Result DateTime" - The 'effectiveTime' tag
                is missing. Refer to section 7.1.5.1 and 8.3 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:effectiveTime) > 1">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST
                RESULT - "Pathology Test Result / Pathology Test Result DateTime" - The
                'effectiveTime' tag shall appear only once. Refer to section 7.1.5.1 and 8.3 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

 
        <!-- 11/07 - Updated as per MANTIS task 3794 - Enforcing No Nullflavor attributes -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[cda:code/@code='103.16605']/cda:effectiveTime">
               
            <assert test="not(@nullFlavor)">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" -
                "ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:observation/cda:effectiveTime" - 
                The 'effectiveTime' tag 'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
        </rule>
        <!--End of Update -->
        
        <!-- code[@code="103.16605"] - 1..1 -->
        <rule context="cda:code[@code='103.16605']">

            <!-- checking parent path -->

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.20117']/cda:component/cda:section[cda:code/@code='102.16144']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '103.16605']"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result / Pathology Test Result DateTime" - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code='101.20117']/component/section[code/@code='102.16144']/entry/observation/entryRelationship/observation/code/@code = "103.16605"' path - 
                1 or more tags are missing. Refer to section 7.1.5.1 Pathology Test Result of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.1
                PATHOLOGY TEST RESULT - "Pathology Test Result / Pathology Test Result DateTime" -
                The 'code' tag 'codeSystem' attribute shall contain a value '1.2.36.1.2001.1001.101'.
                 Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" - The 'code' tag 'codeSystemName'
                attribute shall contain a value 'NCTIS Data Components'. Refer to section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'PATHOLOGY TEST RESULT DATETIME'"
                >Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" - The 'code' tag 'displayName'
                attribute shall contain a value 'Pathology Test Result DateTime'. Refer to section 7.1.5.1 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- 11/07 - Updated as per MANTIS task 3794 - Enforcing No Nullflavor attributes -->
               
            <assert test="not(@nullFlavor)">Error: e-Referral - 7.1.5.1 PATHOLOGY TEST RESULT - "Pathology Test Result /
                Pathology Test Result DateTime" -
                "ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:observation/cda:code" - 
                The 'code' tag 'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.5.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <!-- End of Update -->
            
        </rule>

    </pattern>

