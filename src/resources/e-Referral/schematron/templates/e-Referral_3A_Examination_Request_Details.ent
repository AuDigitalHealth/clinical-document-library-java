

    <!-- e-Referral Clinical Document:  7.1.5.2.2 Examination Request Details -->

    <!-- This Schematron file validates 7.1.5.2.2 Examination Request Details of 7.1.5 Diagnostic Investigations section of e-Referral body -->

    <!-- Context: ClinicalDocument/component/structuredBody/component[diag_inv]/section/component[im_exam]/section/ -->


    <!-- Status: Last Reviewed: 
         Status: Last Updated : 02/07/2012
 -->


    <!-- 02/07/2012 - Mantis task 3739 - Updated the required rule context to include predicates -->
        
    <!-- duplicates
/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:act/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation/cda:entryRelationship[cda:act/cda:code/@code = '103.16517']
/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:act/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship 
   
/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation /cda:entryRelationship/cda:act/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation/cda:entryRelationship[cda:observation/cda:code/@code = '103.16519']
/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:observation/cda:entryRelationship/cda:act/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship 
   
-->

    <pattern name="p-e-Referral_3A_Examination_Request_Details-errors"
        id="p-e-Referral_3A_Examination_Request_Details-errors"
        see="#p-e-Referral_3A_Examination_Request_Details-errors">

        <!-- Examination Request Details - 0..* -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']">

            <report test="count(cda:act[cda:code/@code = '102.16511']) > 1">Error: e-Referral -
                7.1.5.2.2 Examination Request Details - The 'act' tag shall appear only once. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'SUBJ'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - The 'entryRelationship' tag 'typeCode' attribute shall contain the value
                'SUBJ'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@inversionInd = 'true'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - The 'entryRelationship' tag 'inversionInd' attribute shall contain the
                value 'true'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code = '102.16511']">

            <report test="count(cda:code[@code = '102.16511']) > 1">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - The 'code' tag shall appear only once. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@classCode = 'ACT'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - The 'act' tag 'classCode' attribute shall contain the value 'ACT'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - The 'act' tag 'moodCode' attribute shall contain the value 'EVN'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="cda:code[@code = '102.16511']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code = '102.16511']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - 
                The '/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[code/@code = '101.20117']/cda:component/cda:section[code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code = '102.16511']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - The 'CODE' tag 'codeSystem' attribute shall be
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - The 'CODE' tag
                'codeSystemName' attribute shall contain the value 'NCTIS Data Components'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'EXAMINATION REQUEST DETAILS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - The 'code' tag
                'displayName' attribute shall contain the value 'Examination Request Details'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Examination Requested Name - 0..* - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship[cda:observation/cda:code/@code = '103.16512']">

            <report test="count(cda:observation[cda:code/@code = '103.16512']) > 1">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'observation' tag shall
                appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'REFR'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details > Examination Requested Name" - The
                'entryRelationship' tag 'typeCode' attribute shall contain the value 'REFR'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:observation[cda:code/@code = '103.16512']">

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Examination Requested Name" - The
                'observation' tag 'classCode' attribute shall contain the value 'OBS'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Examination Requested Name" - The
                'observation' tag 'moodCode' attribute shall contain the value 'EVN'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="cda:text">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Examination Requested Name" - The 'text' tag is
                missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="normalize-space(cda:text) !=  ''">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Examination Requested
                Name" - The 'text' tag shall contain a value. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


        </rule>

        <rule context="cda:code[@code = '103.16512']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '103.16512']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code = '101.20117']/component/section[code/@code = '102.16145']/entry[observation/@classCode='OBS']/observation/entryRelationship[act/code/@code = '102.16511']/act/entryRelationship/observation/code[@code = '103.16512']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Examination Requested
                Name" - The 'code' tag 'codeSystem' attribute shall contain the value
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Examination Requested Name" - The 'code' tag 'codeSystemName' attribute
                shall be 'NCTIS Data Components'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'EXAMINATION REQUESTED NAME'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Examination Requested Name" - The 'code' tag 'displayName' attribute shall
                be 'Examination Requested Name'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- DICOM Study Identifier - 0..1 - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship[cda:act/cda:code/@code = '103.16513']">

            <report test="count(cda:act[cda:code/@code = '103.16513']) > 1">Error: e-Referral -
                7.1.5.2.2 Examination Request Details - The 'act' tag shall appear only once. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'SUBJ'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / DICOM Study
                Identifier" - The 'entryRelationship' tag 'typeCode' attribute shall contain the
                value 'SUBJ'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']">

            <assert test="@classCode = 'ACT'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / DICOM Study
                Identifier" - The 'act' tag 'classCode' attribute shall contain the value 'ACT'.
                Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / DICOM Study
                Identifier" - The 'act' tag 'moodCode' attribute shall contain the value 'EVN'.
                Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:code[@code = '103.16513']) > 1">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Imaging Examination Result / Examination Request
                Details / DICOM Study Identifier" - The 'code' tag shall appear once. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="cda:id">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Imaging Examination Result / Examination Request Details / DICOM Study Identifier"
                - The 'id' tag is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / DICOM Study
                Identifier" - The 'id' tag shall appear once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

        <rule context="cda:code[@code = '103.16513']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act/cda:code[@code = '103.16513']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code = '101.20117']/component/section[code/@code = '102.16145']/entry[observation/@classCode='OBS']/observation/entryRelationship[act/code/@code = '102.16511']/act/entryRelationship/act/code[@code = '103.16513']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Imaging Examination Result / Examination Request
                Details / DICOM Study Identifier" - The 'code' tag 'codeSystem' attribute shall be
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Imaging Examination
                Result / Examination Request Details / DICOM Study Identifier" - The 'code' tag
                'codeSystemName' attribute shall contain the value 'NCTIS Data Components'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'DICOM STUDY IDENTIFIER'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Imaging Examination
                Result / Examination Request Details / DICOM Study Identifier" - The 'code' tag
                'displayName' attribute shall contain the value 'DICOM Study Identifier'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Report Identifier - 0..1 - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship[cda:observation/cda:code/@code = '103.16514']">

            <report test="count(cda:observation[cda:code/@code = '103.16514']) > 1">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'observation' tag shall
                appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Report Identifier" - The
                'entryRelationship' tag 'typeCode' attribute shall contain the value 'COMP'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:observation[cda:code/@code = '103.16514']">

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Report Identifier" - The 'observation' tag
                'classCode' attribute shall contain the value 'OBS'. Refer to section 7.1.5.2.2 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Report Identifier" - The 'observation' tag
                'moodCode' attribute shall contain the value 'EVN'. Refer to section 7.1.5.2.2 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="cda:id">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Report Identifier" - The 'id' tag is missing. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Report Identifier" - The 'id' tag shall
                appear once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Report Identifier" - The 'code' tag shall
                appear once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>


        </rule>

        <rule context="cda:code[@code = '103.16514']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '103.16514']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - 
                The '/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[code/@code = '101.20117']/cda:component/cda:section[code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:code[@code = '103.16514']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Report Identifier" -
                The 'code' tag 'codeSystem' attribute shall contain the value
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Report Identifier" - The 'code' tag 'codeSystemName' attribute shall be
                'NCTIS Data Components'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'REPORT IDENTIFIER'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Report Identifier" - The 'code' tag 'displayName' attribute shall be
                'Report Identifier'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Image Details - 0..* - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship[cda:observation/cda:code/@code = '103.16515']">

            <report test="count(cda:observation[cda:code/@code = '103.16515']) > 1">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'observation' tag shall
                appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'COMP'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details" - The 'entryRelationship'
                tag 'typeCode' attribute shall contain the value 'COMP'. Refer to section 7.1.5.2.2
                of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']">

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details" - The 'observation' tag
                'classCode' attribute shall contain the value 'OBS'. Refer to section 7.1.5.2.2 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details" - The 'observation' tag
                'moodCode' attribute shall contain the value 'EVN'. Refer to section 7.1.5.2.2 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <!-- Image Identifier - 0..1 - Errors -->

            <assert test="cda:id">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Image Identifier" - The 'id' tag is
                missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image Identifier" - The
                'id' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- Image View Name - 0..1 - Errors -->

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image View Name" - The
                'value' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <!-- Image DateTime - 0..1 - Errors -->

            <assert test="cda:effectiveTime">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image View Name" - The
                'effectiveTime' tag is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:effectiveTime) > 1">Error: e-Referral - 7.1.5.2.2 Examination
                Request Details - "Examination Request Details / Image Details / Image View Name" -
                The 'effectiveTime' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>



        </rule>

        <rule context="cda:code[@code = '103.16515']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation/cda:code[@code = '103.16515']"
                >aaaaError: e-Referral - 7.1.5.2.2 Examination Request Details - 
                The '/ClinicalDocument/component/structuredBody/component/section[code/@code = '101.20117']/component/section[code/@code = '102.16145']/entry[observation/@classCode='OBS']/observation/entryRelationship[act/code/@code = '102.16511']/act/entryRelationship/act[code/@code = '103.16513']/entryRelationship/observation/code[@code = '103.16515']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Image Details" - The
                'code' tag 'codeSystem' attribute shall contain the value '1.2.36.1.2001.1001.101'.
                Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Image Details" - The 'code' tag 'codeSystemName' attribute shall contain
                the value 'NCTIS Data Components'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'IMAGE DETAILS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Image Details" - The 'code' tag 'displayName' attribute shall contain the
                value 'Image Details'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Image View Name > value tags - attributes - 0..1 - Errors -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:value">

       <!--<assert test="@code or @nullFlavor">Error: e-Referral - Global Clinical Document check
                for "cda:code/@code" attribute - The 'value' tag 'code' OR
                'nullFlavor' attribute is missing. 
                Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <assert test="@codeSystem or @nullFlavor">Error: e-Referral - Global Clinical Document
                check for "cda:code/@codeSystem" attribute - The 'value' tag 
                'codeSystem' OR 'nullFlavor' attribute is missing. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <report test="(@code and not(@codeSystem)) or (not(@code) and @codeSystem)"> Error:
                Error: e-Referral - Global Clinical Document check for "cda:code/@codeSystem"
                attribute - The 'value' tag shall have 'code' and 'codeSystem' attributes.
                Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>
            
            <report test="(@code or @codeSystem) and @nullFlavor">Error: e-Referral - Global
                Clinical Document check for "cda:code/@codeSystem" attribute - The 'value' tag shall
                have 'code' and 'codeSystem' OR 'nullFlavor' attribute(s) but not both.
                Refer to section 8.1 of
                the e-Referral_CDA_Implementation_Guide_v2.2.</report>-->

            <assert
                test="cda:originalText or (@code and @codeSystem) or @nullFlavor or cda:translation"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - The 'code' tag shall
                have 'originalText' or 'transalation' tag or 'code' and 'codeSystem' OR 'nullFlavor'
                attributes. Check all 'cda:code' tags to find the missing attribute. Refer to
                section 8.1 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="@code and normalize-space(@code) = ''">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - The 'value' tag 'code' attribute shall contain a
                value. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystem and normalize-space(@codeSystem) = ''">Error: e-Referral -
                7.1.5.2.2 Examination Request Details - The 'value' tag 'codeSystem' attribute shall
                contain a value. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@codeSystemName and normalize-space(@codeSystemName) = ''">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'value' tag
                'codeSystemName' attribute shall contain a value. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="@displayName and normalize-space(@displayName) = ''">Error: e-Referral -
                7.1.5.2.2 Examination Request Details - The 'code' tag 'displayName' attribute shall
                contain a value. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="cda:originalText and normalize-space(cda:originalText) = ''">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'originalText' tag shall
                contain a value. Check all 'code/cda:originalText' tags to find the missing text.
                Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="count(cda:originalText) > 1">Error: e-Referral - 7.1.5.2.2 Examination
                Request Details - The 'originalText' tag shall appear only once. Check all
                'code/cda:originalText' tags to find the missing text. Refer to section 8.1 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

        <!-- DICOM Series Identifiers - 0..1 - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship[cda:act/cda:code/@code = '103.16517']">

            <report test="count(cda:act[cda:code/@code = '103.16517']) > 1">Error: e-Referral -
                7.1.5.2.2 Examination Request Details - The 'act' tag shall appear only once. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'REFR'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / Image Details
                / DICOM Series Identifier" - The 'entryRelationship' tag 'typeCode' attribute shall
                be 'REFR'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship/cda:act[cda:code/@code = '103.16517']">

            <assert test="@classCode = 'ACT'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / Image Details
                / DICOM Series Identifier" - The 'act' tag 'classCode' attribute shall contain the
                value 'ACT'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result / Examination Request Details / Image Details
                / DICOM Series Identifier" - The 'act' tag 'moodCode' attribute shall contain the
                value 'EVN'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="cda:id">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / DICOM Series Identifier" - The 'id'
                tag is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / DICOM Series Identifier" -
                The 'id' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Imaging Examination Result /Examination Request Details / Image Details /
                DICOM Series Identifier" - The 'value' tag shall appear only once. Refer to section
                7.1.5.2.2 of the e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

        <rule context="cda:code[@code = '103.16517']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship/cda:act/cda:code[@code = '103.16517']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - The
                '/ClinicalDocument/component/structuredBody/component/section[code/@code = '101.20117']/component/section[code/@code = '102.16145']/entry[observation/@classCode='OBS']/observation/entryRelationship[act/code/@code = '102.16511']/act/entryRelationship/act[code/@code = '103.16513']/entryRelationship/observation[code/@code = '103.16515']/entryRelationship/act/code[@code = '103.16517']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Imaging Examination Result / Examination Request
                Details / Image Details / DICOM Series Identifier" - The 'code' tag 'codeSystem'
                attribute shall contain the value '1.2.36.1.2001.1001.101'. Refer to section
                7.1.5.2.2 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Imaging Examination
                Result / Examination Request Details / Image Details / DICOM Series Identifier" -
                The 'code' tag 'codeSystemName' attribute shall contain the value 'NCTIS Data
                Components'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'DICOM SERIES IDENTIFIER'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Imaging Examination
                Result / Examination Request Details / Image Details / DICOM Series Identifier" -
                The 'code' tag 'displayName' attribute shall contain the value 'DICOM Series
                Identifier'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Subject Position - 0..1 - Errors -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship[cda:observation/cda:code/@code = '103.16519']">

            <report test="count(cda:observation[cda:code/@code = '103.16519']) > 1">Error:
                e-Referral - 7.1.5.2.2 Examination Request Details - The 'observation' tag shall
                appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="@typeCode = 'REFR'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Subject Position" - The
                'entryRelationship' tag 'typeCode' attribute shall contain the value 'REFR'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16519']">

            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Subject Position" - The
                'observation' tag 'classCode' attribute shall contain the value 'OBS'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Subject Position" - The
                'observation' tag 'moodCode' attribute shall contain the value 'EVN'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:code) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Subject Position" - The
                'code' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="cda:value">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Subject Position" - The 'value' tag
                is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:value) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Subject Position" - The
                'value' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

        <rule context="cda:code[@code = '103.16519']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship/cda:observation/cda:code[@code = '103.16519']"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                The '/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[code/@code = '101.20117']/cda:component/cda:section[code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[act/code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[code/@code = '103.16513']/cda:entryRelationship/cda:observation[code/@code = '103.16515']/cda:entryRelationship/cda:observation/cda:code[@code = '103.16519']' path - 
                1 or more tags are missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>


            <assert test="@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Image Details / Subject
                Position" - The 'code' tag 'codeSystem' attribute shall contain the value
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Image Details / Subject Position" - The 'code' tag 'codeSystemName'
                attribute shall contain the value 'NCTIS Data Components'. Refer to section
                7.1.5.2.2 of the e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert
                test="translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SUBJECT POSITION'"
                >Error: e-Referral - 7.1.5.2.2 Examination Request Details - "Examination Request
                Details / Image Details / Subject Position" - The 'code' tag 'displayName' attribute
                shall contain the value 'Subject Position'. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16519']/cda:value">

            <assert test="@xsi:type">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Subject Position" - The 'value' tag
                'xsi:type' attribute is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="normalize-space(@xsi:type) !=  ''">Error: e-Referral - 7.1.5.2.2
                Examination Request Details - "Examination Request Details / Image Details / Subject
                Position" - The 'value' tag 'xsi:type' attribute shall contain a value. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>


        <!-- Image - 0..1 - Errors -->
        <!-- NOTE:  '103.16515'  used instead of '103.16519'
                           to get the correct "rule context"  to go to  <entryRelationship typeCode = "SPRT"> -->

        <!-- <rule
            context="*[cda:code/@code = '103.16515']/cda:entryRelationship[translate(@typeCode, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SPRT']">
       -->

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship[translate(@typeCode, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SPRT']">

            <assert test="@typeCode = 'SPRT'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image" - The
                'entryRelationship' tag 'typeCode' attribute shall contain the value 'SPRT'. Refer
                to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="cda:observationMedia">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image" - The
                'observationMedia' tag is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:observationMedia) > 1">Error: e-Referral - 7.1.5.2.2 Examination
                Request Details - "Examination Request Details / Image Details / Image" - The
                'observationMedia' tag shall appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

        </rule>

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[cda:code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act[cda:code/@code = '103.16513']/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship[translate(@typeCode, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SPRT']/cda:observationMedia">
  
            <assert test="@classCode = 'OBS'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image" - The
                'observationMedia' tag 'classCode' attribute shall contain the value 'OBS'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="@moodCode = 'EVN'">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image" - The
                'observationMedia' tag 'moodCode' attribute shall contain the value 'EVN'. Refer to
                section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <assert test="cda:id">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Image" - The 'id' tag is missing.
                Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

            <report test="count(cda:id) > 1">Error: e-Referral - 7.1.5.2.2 Examination Request
                Details - "Examination Request Details / Image Details / Image" - The 'id' tag shall
                appear only once. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</report>

            <assert test="cda:value">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Image" - The 'value' tag is missing.
                Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>

        </rule>

        <!--Below rule removed as per Mantis 2308-->

    <!--<rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code = '101.20117']/cda:component/cda:section[code/@code = '102.16145']/cda:entry/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code = '102.16511']/cda:act/cda:entryRelationship/cda:act/cda:entryRelationship/cda:observation[cda:code/@code = '103.16515']/cda:entryRelationship[translate(@typeCode, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'SPRT']/cda:observationMedia/cda:value">

            <assert test="@xsi:type">Error: e-Referral - 7.1.5.2.2 Examination Request Details -
                "Examination Request Details / Image Details / Image" - The 'value' tag 'xsi:type'
                attribute is missing. Refer to section 7.1.5.2.2 of the
                e-Referral_CDA_Implementation_Guide_v2.2.</assert>
            
            <!-\-Updated NG 27/02/2012 ID:2309 -\->

        </rule>-->

    </pattern>


