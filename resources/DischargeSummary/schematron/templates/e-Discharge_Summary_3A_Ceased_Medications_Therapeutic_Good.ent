

    <!--  Discharge Summary Clinical Document:  7.1.2.2.2 THERAPEUTIC GOOD -->

    <!--    Context: Ceased  Medications : ClinicalDocument/component/structuredBody/component[meds]/section/component[ceased]/section-->

    <!-- Status: Last Reviewed: Not reviewed.
        Status: Last Updated : 11/07/2012 -->


    <!-- 02/07/2012 - Mantis task 3741 - Updated the rule contexts to include predicates -->
    
    <pattern name="p-e-Discharge_Summary_3A_Ceased_Medications_Therapeutic_Good-errors"
        id="p-e-Discharge_Summary_3A_Ceased_Medications_Therapeutic_Good-errors"
        see="#p-e-Discharge_Summary_3A_Ceased_Medications_Therapeutic_Good-errors">

        <!--CDA Body Level 3 Data Elements-->

        <!--Therapeutic Good - 0..* -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry[cda:substanceAdministration/@classCode='SBADM']">

            <!-- substanceAdministration - 1..1 -->

            <report test="count(cda:substanceAdministration[@classCode='SBADM']) > 1">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good" - The
                'substanceAdministration' tag shall appear only once.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'entry' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']"> -->

        </rule>

        <!-- substanceAdministration - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']">

            <!-- @moodCode -->

            <assert test="@moodCode = 'EVN'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good" - The 'substanceAdministration' tag 'moodCode'
                attribute shall contain the value 'EVN'. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- id - 1..1 -->

            <assert test="cda:id">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good" - The 'id' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:id) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good" - The 'id' tag shall appear only once.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- id tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->


            <!-- statusCode - 1..1 -->

            <assert test="cda:statusCode">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good" - The 'statusCode' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:statusCode) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good" - The 'statusCode' tag shall appear only once.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'statusCode' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:statusCode"> -->


            <!-- Therapeutic Good Identification - 1..1 -->

            <assert test="cda:consumable">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Therapeutic Good Identification" - The 'consumable' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:consumable) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Therapeutic Good Identification" - The 'consumable' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'Therapeutic Good Identification' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:consumable"> -->


            <!-- Medical History - 1..1 -->
            <!-- This logical NEHTA data component has no mapping to CDA. -->


            <!-- Item Status - 1..1 -->

            <assert test="cda:entryRelationship[@typeCode='SUBJ']">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical
                History / Item Status" - The 'entryRelationship' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:entryRelationship[@typeCode='SUBJ']) > 1">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical
                History / Item Status" - The 'entryRelationship' tag shall appear only once.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'Item Status' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SUBJ']"> -->


            <!-- Change Detail - 1..1 -->

            <assert test="cda:entryRelationship[@typeCode='SPRT']">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical
                History / Change Detail" - The 'entryRelationship' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:entryRelationship[@typeCode='SPRT']) > 1">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical
                History / Change Detail" - The 'entryRelationship' tag shall appear only once.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'Change Detail' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SPRT']"> -->





        </rule>


        <!-- statusCode - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:statusCode">

            <!-- @code -->

            <assert test="@code = 'cancelled'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good" - The 'statusCode' tag 'code' attribute shall
                contain the value 'cancelled'. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

        </rule>

        <!-- Therapeutic Good Identification - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:consumable">

            <!-- manufacturedProduct - 1..1 -->

            <assert test="cda:manufacturedProduct">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Therapeutic Good Identification" - The 'manufacturedProduct' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:manufacturedProduct) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Therapeutic Good Identification" - The 'manufacturedProduct' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'manufacturedProduct' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:consumable/cda:manufacturedProduct"> -->

        </rule>


        <!-- manufacturedProduct - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:consumable/cda:manufacturedProduct">

            <!-- manufacturedMaterial - 1..1 -->

            <assert test="cda:manufacturedMaterial">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Therapeutic Good Identification" - The 'manufacturedMaterial' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:manufacturedMaterial) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Therapeutic Good Identification" - The 'manufacturedMaterial' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'manufacturedMaterial' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial"> -->

        </rule>

        <!-- manufacturedMaterial - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial">

            <!-- code - 1..1 -->

            <assert test="cda:code">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Therapeutic Good Identification" - The 'code' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:code) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Therapeutic Good Identification" - The 'code' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- code tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->

        </rule>
        
       <!--commented out the test for CCA- 84 change request-->
        
        <!-- code @nullflavor -->
        <!--<rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                       /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                       /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                       /cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code">
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Therapeutic Good Identification" - The 'code' tag 'nullFlavor' attribute shall not 
                be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.2.2.2 of the 
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
        </rule>-->


        <!-- Item Status - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SUBJ']">

            <!-- @inversionInd -->

            <assert test="@inversionInd = 'true'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'entryRelationship'
                tag 'inversionInd' attribute shall contain the value 'true'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- observation - 1..1 -->

            <assert test="cda:observation">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'observation' tag
                is missing. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:observation) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'observation' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'observation' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SUBJ']/cda:observation"> -->

        </rule>

        <!-- observation - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SUBJ']/cda:observation">

            <!-- @classCode -->

            <assert test="@classCode = 'OBS'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'observation'
                tag 'classCode' attribute shall contain the value 'OBS'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @moodCode -->

            <assert test="@moodCode = 'EVN'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'observation'
                tag 'moodCode' attribute shall contain the value 'EVN'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
            <!-- @nullflavor -->
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good
                > Medication History > Item Status" - The 'observation' tag 'nullFlavor' attribute 
                shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.2.2.2 of 
                the e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- code - 1..1 -->

            <assert test="cda:code">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Medical History / Item Status" - The 'code' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:code) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'code' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- code tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->


            <!-- id - 1..1 -->

            <assert test="cda:id">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Medical History / Item Status" - The 'id' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:id) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Item Status" - The 'id' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- id tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->

        </rule>
        
        <!-- code @nullflavor - 1..1 -->
        
        <!-- Start Mantis 3220 - Add Missing Predicates -->
        <!-- <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
            /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
            /cda:entry/cda:substanceAdministration[@classCode='SBADM']
            /cda:entryRelationship[@typeCode='SUBJ']/cda:observation/cda:code">-->
            
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                       /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                       /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                       /cda:entryRelationship[@typeCode='SUBJ']/cda:observation[@classCode='OBS']/cda:code">
        <!-- End Mantis 3220 -->
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good
                > Medication History > Item Status" - The 'code' tag 'nullFlavor' attribute 
                shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.2.2.2 of 
                the e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
        </rule>
        
        <!-- id @nullflavor - 1..1 -->
        <!-- Start Mantis 3220 - Add Missing Predicates -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
            /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
            /cda:entry/cda:substanceAdministration[@classCode='SBADM']
            /cda:entryRelationship[@typeCode='SUBJ']/cda:observation[@classCode='OBS']/cda:id">
            
           <!-- <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                /cda:entryRelationship[@typeCode='SUBJ']/cda:observation/cda:id">-->
         <!-- End Mantis 3220 --> 
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good
                > Medication History > Item Status" - The 'id' tag 'nullFlavor' attribute 
                shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section 7.1.2.2.2 of 
                the e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
        </rule>
        
        <!-- code @nullflavor - 1..1 -->
        <!-- Start Mantis 3220 - Add Missing Predicates -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                       /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                       /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                       /cda:entryRelationship[@typeCode='SPRT']/cda:observation[@typeCode='OBS']/cda:code">
            
            <!--<rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                /cda:entryRelationship[@typeCode='SPRT']/cda:observation/cda:code">-->
            <!-- End Mantis 3220 -->   
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Medication History > Change Detail > Changes Made" - The 'code' tag 'nullFlavor' 
                attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and section
                7.1.2.2.2 of the e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
        </rule>            
        
        <!-- Change Detail - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']">

            <!-- observation - 1..1 -->

            <assert test="cda:observation">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail" - The 'observation' tag
                is missing. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:observation) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail" - The 'observation' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'observation' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SPRT']/cda:observation"> -->

        </rule>

        <!-- observation - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']/cda:observation">

            <!-- @classCode -->

            <assert test="@classCode = 'OBS'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail" - The 'observation'
                tag 'classCode' attribute shall contain the value 'OBS'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @moodCode -->

            <assert test="@moodCode = 'EVN'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail" - The 'observation'
                tag 'moodCode' attribute shall contain the value 'EVN'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- id - 1..1 -->

            <assert test="cda:id">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Medical History / Change Detail" - The 'id' tag is missing.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:id) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail" - The 'id' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- id tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->


            <!-- Changes Made - 1..1 -->

            <assert test="cda:code">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Medical History / Change Detail / Changes Made" - The 'code'
                tag is missing. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:code) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Changes Made" - The
                'code' tag shall appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- code tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->


            <!-- Reason for Change - 0..1 -->

            <report test="count(cda:entryRelationship[cda:act/cda:code/@code='103.10177']) > 1">Error:
                e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical
                History / Change Detail / Reason for Change" - The 'entryRelationship' tag shall
                appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'Reason for Change' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SPRT']/cda:observation/cda:entryRelationship[cda:act/cda:code/@code='103.10177']"> -->

        </rule>


        <!-- Reason for Change - 0..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']/cda:observation[@classCode='OBS']/cda:entryRelationship[cda:act/cda:code/@code='103.10177']">

            <!-- @typeCode -->

            <assert test = "@typeCode = 'RSON'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'entryRelationship' tag 'typeCode' attribute shall contain the value 'RSON'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- act - 1..1 -->

            <report test="count(cda:act) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'act' tag shall appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'act' tag see below rule context:
                <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody
                               /cda:component/cda:section[cda:code/@code='101.16022']
                               /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                               /cda:entry/cda:substanceAdministration[@classCode='SBADM']
                               /cda:entryRelationship[@typeCode='SPRT']/cda:observation/cda:entryRelationship/cda:act[cda:code/@code='103.10177']"> -->

        </rule>

        <!-- act - 1..1 -->
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']/cda:component/cda:section[cda:code/@code='101.16146.4.1.2']/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='103.10177']">

            <!-- @classCode -->

            <assert test="@classCode = 'INFRM'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'act' tag 'classCode' attribute shall contain the value 'INFRM'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @moodCode -->

            <assert test="@moodCode = 'EVN'">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'act' tag 'moodCode' attribute shall contain the value 'EVN'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
            <!-- @nullflavor -->
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Medication History > Change Detail > Reason for Change" - The 'act' tag 
                'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and 
                section 7.1.2.2.2 of the e-Discharge_Summary_CDA_Implementation_Guide_v3.4 </assert>

            <!-- code - 1..1 -->

            <report test="count(cda:code) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'code' tag shall appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- For 'code' tag see below rule context:  <rule context="cda:code[@code = '103.10177']"> -->


            <!-- id - 1..1 -->

            <assert test="cda:id">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good -
                "Therapeutic Good / Medical History / Change Detail / Reason for Change" - The
                'id' tag is missing. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <report test="count(cda:id) > 1">Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic
                Good - "Therapeutic Good / Medical History / Change Detail / Reason for Change" -
                The 'id' tag shall appear only once. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</report>

            <!-- id tag attributes shall be validated by e-Discharge_Summary_Global_Checks.sch/ent file-->


        </rule>

        <!-- code - 1..1 -->
        <rule context="cda:code[@code = '103.10177']">

            <assert test="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code='103.10177']"
                >Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - 
                The "/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section/cda:component/cda:section/cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship/cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act/cda:code[@code='103.10177']" path - 
                1 or more tags are missing. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @codeSystem -->

            <assert test = "@codeSystem = '1.2.36.1.2001.1001.101'">Error: e-Discharge Summary -
                7.1.2.2.2 Therapeutic Good - "Therapeutic Good / Medical History / Change
                Detail / Reason for Change" - The 'code' tag 'codeSystem' attribute shall be
                '1.2.36.1.2001.1001.101'. Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @codeSystemName -->

            <assert test = "translate(@codeSystemName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'NCTIS DATA COMPONENTS'"
                >Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good /
                Medical History / Change Detail / Reason for Change" - The 'code' tag
                'codeSystemName' attribute shall be 'NCTIS Data Components'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>

            <!-- @displayName -->

            <assert test = "translate(@displayName, 'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ') = 'REASON FOR CHANGE'"
                >Error: e-Discharge Summary - 7.1.2.2.2 Therapeutic Good - "Therapeutic Good /
                Medical History / Change Detail / Reason for Change" - The value of the 'code'
                tag 'displayName' attribute shall be 'Reason for Change'.
                Refer to section 7.1.2.2.2 of the
                e-Discharge_Summary_CDA_Implementation_Guide_v3.4.</assert>
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Medication History > Change Detail > Reason for Change" - The 'code' tag 
                'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and 
                section 7.1.2.2.2 of the e-Discharge_Summary_CDA_Implementation_Guide_v3.4 </assert>

        </rule>
        
        <!-- id @nullflavor - 1..1 -->
        
        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
                       /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
                       /cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']
                       /cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='103.10177']/cda:id">
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Medication History > Change Detail > Reason for Change" - The 'id' tag 
                'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and 
                section 7.1.2.2.2 of the e-Discharge_Summary_CDA_Implementation_Guide_v3.4 </assert>
            
        </rule>            

        <rule context="/cda:ClinicalDocument/cda:component/cda:structuredBody/cda:component/cda:section[cda:code/@code='101.16022']
            /cda:component/cda:section[cda:code/@code='101.16146.4.1.2']
            /cda:entry/cda:substanceAdministration[@classCode='SBADM']/cda:entryRelationship[@typeCode='SPRT']
            /cda:observation[@classCode='OBS']/cda:entryRelationship/cda:act[cda:code/@code='103.10177']/cda:text">
            
            <assert test="not(@nullFlavor)">Error: e-Discharge Summary - 7.1.2.2.2 "Therapeutic Good 
                > Medication History > Change Detail > Reason for Change" - The 'text' tag 
                'nullFlavor' attribute shall not be present. Refer to requirements in the NullFlavor Usage Clarification FAQ and 
                section 7.1.2.2.2 of the e-Discharge_Summary_CDA_Implementation_Guide_v3.4 </assert>
            
        </rule>     
        
    </pattern>


